<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar View</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/date-fns/2.29.3/index.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/lucide.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/lucide.min.js"></script>
    <style>
        .lucide {
            width: 16px;
            height: 16px;
        }
    </style>
</head>
<body class="bg-gray-50 p-4">
    <div class="max-w-7xl mx-auto">
        <!-- Card container -->
        <div class="bg-white rounded-lg shadow-md">
            <div class="p-6">
                <!-- Calendar content will be rendered here -->
                <div id="calendar-content"></div>
            </div>
        </div>
    </div>

    <!-- Quick Reserve Modal -->
    <div id="quickReserveModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-md w-full p-6">
                <h3 class="text-lg font-semibold mb-4">Reserva Rápida</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Data e Hora</label>
                        <p id="modalDateTime" class="text-gray-600"></p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Quadra</label>
                        <select id="modalQuadra" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            <option value="quadra1">Quadra 1</option>
                            <option value="quadra2">Quadra 2</option>
                            <option value="quadra3">Quadra 3</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Cliente</label>
                        <input type="text" id="modalCliente" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="Nome do cliente">
                    </div>
                    <div class="flex justify-end space-x-2">
                        <button onclick="closeQuickReserveModal()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50">
                            Cancelar
                        </button>
                        <button onclick="confirmReservation()" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                            Confirmar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data mock e configurações
        const mockData = {
            reservas: [
                {
                    id: '1',
                    dataInicio: new Date(2025, 7, 5, 10, 0),
                    dataFim: new Date(2025, 7, 5, 11, 0),
                    cliente: { nome: 'João Silva' },
                    quadra: { nome: 'Quadra 1' },
                    quadraId: 'quadra1',
                    status: 'confirmado'
                },
                {
                    id: '2',
                    dataInicio: new Date(2025, 7, 5, 14, 0),
                    dataFim: new Date(2025, 7, 5, 15, 0),
                    cliente: { nome: 'Maria Santos' },
                    quadra: { nome: 'Quadra 2' },
                    quadraId: 'quadra2',
                    status: 'pendente'
                },
                {
                    id: '3',
                    dataInicio: new Date(2025, 7, 6, 9, 0),
                    dataFim: new Date(2025, 7, 6, 10, 0),
                    cliente: { nome: 'Pedro Costa' },
                    quadra: { nome: 'Quadra 1' },
                    quadraId: 'quadra1',
                    status: 'confirmado'
                }
            ],
            quadras: [
                { id: 'quadra1', nome: 'Quadra 1' },
                { id: 'quadra2', nome: 'Quadra 2' },
                { id: 'quadra3', nome: 'Quadra 3' }
            ],
            profileSettings: {
                horarioFuncionamento: {
                    inicio: '06:00',
                    fim: '22:00'
                }
            }
        };

        // Estado da aplicação
        let appState = {
            selectedDate: new Date(),
            currentMonth: new Date(),
            currentWeek: new Date(),
            view: 'month',
            filtroQuadra: 'todas',
            quickReserveModal: {
                open: false,
                date: new Date(),
                hour: 0
            }
        };

        // Utility functions
        function formatDate(date, format) {
            const options = {
                d: { day: 'numeric' },
                'dd': { day: '2-digit' },
                'EEE': { weekday: 'short' },
                'EEEE': { weekday: 'long' },
                'MMM': { month: 'short' },
                'MMMM': { month: 'long' },
                'yyyy': { year: 'numeric' }
            };

            if (format === 'd') return date.getDate();
            if (format === 'HH:mm') return date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
            if (format === 'MMMM yyyy') return date.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });
            if (format === "EEEE, d 'de' MMMM 'de' yyyy") return date.toLocaleDateString('pt-BR', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
            
            return date.toLocaleDateString('pt-BR');
        }

        function isSameDay(date1, date2) {
            return date1.getDate() === date2.getDate() &&
                   date1.getMonth() === date2.getMonth() &&
                   date1.getFullYear() === date2.getFullYear();
        }

        function isSameMonth(date1, date2) {
            return date1.getMonth() === date2.getMonth() &&
                   date1.getFullYear() === date2.getFullYear();
        }

        function startOfMonth(date) {
            return new Date(date.getFullYear(), date.getMonth(), 1);
        }

        function endOfMonth(date) {
            return new Date(date.getFullYear(), date.getMonth() + 1, 0);
        }

        function startOfWeek(date) {
            const day = date.getDay();
            const diff = date.getDate() - day;
            return new Date(date.setDate(diff));
        }

        function endOfWeek(date) {
            const startWeek = startOfWeek(new Date(date));
            return new Date(startWeek.getTime() + 6 * 24 * 60 * 60 * 1000);
        }

        function addMonths(date, months) {
            const newDate = new Date(date);
            newDate.setMonth(newDate.getMonth() + months);
            return newDate;
        }

        function addDays(date, days) {
            const newDate = new Date(date);
            newDate.setDate(newDate.getDate() + days);
            return newDate;
        }

        function addWeeks(date, weeks) {
            return addDays(date, weeks * 7);
        }

        function getDaysInMonth(date) {
            const monthStart = startOfMonth(date);
            const monthEnd = endOfMonth(date);
            const startDate = startOfWeek(new Date(monthStart));
            const endDate = endOfWeek(new Date(monthEnd));
            
            const days = [];
            const current = new Date(startDate);
            
            while (current <= endDate) {
                days.push(new Date(current));
                current.setDate(current.getDate() + 1);
            }
            
            return days;
        }

        function getWeekDays(date) {
            const weekStart = startOfWeek(new Date(date));
            const days = [];
            
            for (let i = 0; i < 7; i++) {
                const day = new Date(weekStart);
                day.setDate(weekStart.getDate() + i);
                days.push(day);
            }
            
            return days;
        }

        function getReservasForDay(day) {
            const reservasFiltradas = appState.filtroQuadra === 'todas' 
                ? mockData.reservas 
                : mockData.reservas.filter(r => r.quadraId === appState.filtroQuadra);
            
            return reservasFiltradas.filter(reserva => 
                isSameDay(reserva.dataInicio, day) && reserva.status !== 'cancelado'
            );
        }

        function getBusinessHours() {
            const [inicioHora] = mockData.profileSettings.horarioFuncionamento.inicio.split(':').map(Number);
            const [fimHora] = mockData.profileSettings.horarioFuncionamento.fim.split(':').map(Number);
            return { inicioHora, fimHora };
        }

        // Navigation functions
        function navigateMonth(direction) {
            appState.currentMonth = direction === 'prev' 
                ? addMonths(appState.currentMonth, -1) 
                : addMonths(appState.currentMonth, 1);
            renderCalendar();
        }

        function navigateWeek(direction) {
            appState.currentWeek = direction === 'prev' 
                ? addWeeks(appState.currentWeek, -1) 
                : addWeeks(appState.currentWeek, 1);
            appState.selectedDate = appState.currentWeek;
            renderCalendar();
        }

        function navigateDay(direction) {
            appState.selectedDate = direction === 'prev' 
                ? addDays(appState.selectedDate, -1) 
                : addDays(appState.selectedDate, 1);
            renderCalendar();
        }

        function selectDate(date) {
            appState.selectedDate = date;
            renderCalendar();
        }

        function changeView(view) {
            appState.view = view;
            renderCalendar();
        }

        // Modal functions
        function openQuickReserveModal(date, hour) {
            appState.quickReserveModal = {
                open: true,
                date: date,
                hour: hour
            };
            
            const modal = document.getElementById('quickReserveModal');
            const dateTime = document.getElementById('modalDateTime');
            
            const dateStr = formatDate(date, "d 'de' MMMM 'de' yyyy");
            const timeStr = `${String(hour).padStart(2, '0')}:00`;
            dateTime.textContent = `${dateStr} às ${timeStr}`;
            
            modal.classList.remove('hidden');
        }

        function closeQuickReserveModal() {
            appState.quickReserveModal.open = false;
            document.getElementById('quickReserveModal').classList.add('hidden');
        }

        function confirmReservation() {
            const quadra = document.getElementById('modalQuadra').value;
            const cliente = document.getElementById('modalCliente').value;
            
            if (!cliente) {
                alert('Por favor, informe o nome do cliente');
                return;
            }
            
            // Aqui você adicionaria a lógica para salvar a reserva
            console.log('Nova reserva:', {
                date: appState.quickReserveModal.date,
                hour: appState.quickReserveModal.hour,
                quadra: quadra,
                cliente: cliente
            });
            
            closeQuickReserveModal();
            alert('Reserva criada com sucesso!');
        }

        // Render functions
        function renderMonthView() {
            const days = getDaysInMonth(appState.currentMonth);
            const dayNames = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'];
            
            return `
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-2">
                            <button onclick="navigateMonth('prev')" class="px-3 py-1 border border-gray-300 rounded hover:bg-gray-50">
                                <i data-lucide="chevron-left"></i>
                            </button>
                            <h3 class="text-lg font-semibold capitalize">
                                ${formatDate(appState.currentMonth, 'MMMM yyyy')}
                            </h3>
                            <button onclick="navigateMonth('next')" class="px-3 py-1 border border-gray-300 rounded hover:bg-gray-50">
                                <i data-lucide="chevron-right"></i>
                            </button>
                        </div>
                        <select onchange="changeView(this.value)" class="px-3 py-1 border border-gray-300 rounded">
                            <option value="month" ${appState.view === 'month' ? 'selected' : ''}>Mês</option>
                            <option value="week" ${appState.view === 'week' ? 'selected' : ''}>Semana</option>
                            <option value="day" ${appState.view === 'day' ? 'selected' : ''}>Dia</option>
                        </select>
                    </div>

                    <div class="grid grid-cols-7 gap-1">
                        ${dayNames.map(day => `
                            <div class="p-2 text-center text-sm font-medium text-gray-500">
                                ${day}
                            </div>
                        `).join('')}
                        ${days.map(day => {
                            const dayReservas = getReservasForDay(day);
                            const isCurrentMonth = isSameMonth(day, appState.currentMonth);
                            const isSelected = isSameDay(day, appState.selectedDate);
                            const isToday = isSameDay(day, new Date());
                            
                            let dayClass = 'p-2 h-24 border border-gray-200 hover:bg-gray-50 flex flex-col items-start cursor-pointer';
                            
                            if (!isCurrentMonth) {
                                dayClass += ' text-gray-400 bg-gray-50';
                            }
                            if (isSelected) {
                                dayClass += ' bg-blue-600 text-white';
                            } else if (isToday) {
                                dayClass += ' bg-blue-50 text-blue-700 border-blue-200';
                            }
                            
                            return `
                                <button onclick="selectDate(new Date(${day.getFullYear()}, ${day.getMonth()}, ${day.getDate()}))" 
                                        class="${dayClass}">
                                    <span class="text-sm font-medium mb-1">
                                        ${formatDate(day, 'd')}
                                    </span>
                                    <div class="space-y-1 w-full">
                                        ${dayReservas.slice(0, 2).map(reserva => {
                                            const statusClass = reserva.status === 'confirmado' ? 'bg-green-200 text-green-800' :
                                                              reserva.status === 'pendente' ? 'bg-yellow-200 text-yellow-800' :
                                                              'bg-blue-200 text-blue-800';
                                            return `
                                                <div class="text-xs px-1 py-0.5 rounded truncate ${statusClass}">
                                                    ${formatDate(reserva.dataInicio, 'HH:mm')} - ${reserva.cliente.nome}
                                                </div>
                                            `;
                                        }).join('')}
                                        ${dayReservas.length > 2 ? `
                                            <div class="text-xs text-gray-500">
                                                +${dayReservas.length - 2} mais
                                            </div>
                                        ` : ''}
                                    </div>
                                </button>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        function renderWeekView() {
            const weekDays = getWeekDays(appState.currentWeek);
            const weekStart = weekDays[0];
            const weekEnd = weekDays[6];
            
            return `
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-2">
                            <button onclick="navigateWeek('prev')" class="px-3 py-1 border border-gray-300 rounded hover:bg-gray-50">
                                <i data-lucide="chevron-left"></i>
                            </button>
                            <h3 class="text-lg font-semibold">
                                ${formatDate(weekStart, 'd MMM')} - ${formatDate(weekEnd, 'd MMM yyyy')}
                            </h3>
                            <button onclick="navigateWeek('next')" class="px-3 py-1 border border-gray-300 rounded hover:bg-gray-50">
                                <i data-lucide="chevron-right"></i>
                            </button>
                        </div>
                        <select onchange="changeView(this.value)" class="px-3 py-1 border border-gray-300 rounded">
                            <option value="month" ${appState.view === 'month' ? 'selected' : ''}>Mês</option>
                            <option value="week" ${appState.view === 'week' ? 'selected' : ''}>Semana</option>
                            <option value="day" ${appState.view === 'day' ? 'selected' : ''}>Dia</option>
                        </select>
                    </div>

                    <div class="grid grid-cols-7 gap-2">
                        ${weekDays.map(day => {
                            const dayReservas = getReservasForDay(day);
                            const isSelected = isSameDay(day, appState.selectedDate);
                            const isToday = isSameDay(day, new Date());
                            
                            let buttonClass = 'w-full p-3 rounded-lg border text-center hover:bg-gray-50 cursor-pointer';
                            if (isSelected) {
                                buttonClass += ' bg-blue-600 text-white';
                            } else if (isToday) {
                                buttonClass += ' bg-blue-50 text-blue-700 border-blue-200';
                            }
                            
                            return `
                                <div class="space-y-2">
                                    <button onclick="selectDate(new Date(${day.getFullYear()}, ${day.getMonth()}, ${day.getDate()}))" 
                                            class="${buttonClass}">
                                        <div class="text-sm font-medium">
                                            ${day.toLocaleDateString('pt-BR', { weekday: 'short' })}
                                        </div>
                                        <div class="text-lg font-bold">
                                            ${formatDate(day, 'd')}
                                        </div>
                                    </button>
                                    <div class="space-y-1">
                                        ${dayReservas.map(reserva => {
                                            const statusClass = reserva.status === 'confirmado' ? 'bg-green-100 text-green-800' :
                                                              reserva.status === 'pendente' ? 'bg-yellow-100 text-yellow-800' :
                                                              'bg-blue-100 text-blue-800';
                                            return `
                                                <div class="text-xs p-2 rounded ${statusClass}">
                                                    <div class="font-medium">${formatDate(reserva.dataInicio, 'HH:mm')} - ${formatDate(reserva.dataFim, 'HH:mm')}</div>
                                                    <div class="truncate">${reserva.quadra.nome}</div>
                                                    <div class="truncate">${reserva.cliente.nome}</div>
                                                </div>
                                            `;
                                        }).join('')}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        function renderDayView() {
            const dayReservas = getReservasForDay(appState.selectedDate).sort((a, b) => 
                a.dataInicio.getTime() - b.dataInicio.getTime()
            );
            
            const { inicioHora, fimHora } = getBusinessHours();
            const totalHours = fimHora - inicioHora;
            
            return `
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-2">
                            <button onclick="navigateDay('prev')" class="px-3 py-1 border border-gray-300 rounded hover:bg-gray-50">
                                <i data-lucide="chevron-left"></i>
                            </button>
                            <h3 class="text-lg font-semibold capitalize">
                                ${formatDate(appState.selectedDate, "EEEE, d 'de' MMMM 'de' yyyy")}
                            </h3>
                            <button onclick="navigateDay('next')" class="px-3 py-1 border border-gray-300 rounded hover:bg-gray-50">
                                <i data-lucide="chevron-right"></i>
                            </button>
                        </div>
                        <select onchange="changeView(this.value)" class="px-3 py-1 border border-gray-300 rounded">
                            <option value="month" ${appState.view === 'month' ? 'selected' : ''}>Mês</option>
                            <option value="week" ${appState.view === 'week' ? 'selected' : ''}>Semana</option>
                            <option value="day" ${appState.view === 'day' ? 'selected' : ''}>Dia</option>
                        </select>
                    </div>

                    <div class="space-y-2">
                        ${Array.from({ length: totalHours }, (_, i) => {
                            const hour = i + inicioHora;
                            const slotReservas = dayReservas.filter(reserva => 
                                reserva.dataInicio.getHours() <= hour && 
                                reserva.dataFim.getHours() > hour
                            );
                            
                            return `
                                <div class="flex items-center space-x-4 p-3 border rounded-lg">
                                    <div class="w-16 text-sm font-medium text-gray-500">
                                        ${String(hour).padStart(2, '0')}:00
                                    </div>
                                    <div class="flex-1 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2">
                                        ${slotReservas.length > 0 ? 
                                            slotReservas.map(reserva => {
                                                const statusClass = reserva.status === 'confirmado' ? 'bg-green-100 text-green-800' :
                                                                  reserva.status === 'pendente' ? 'bg-yellow-100 text-yellow-800' :
                                                                  'bg-blue-100 text-blue-800';
                                                return `
                                                    <div class="p-3 rounded-lg ${statusClass}">
                                                        <div class="font-medium">${reserva.cliente.nome}</div>
                                                        <div class="text-sm">${reserva.quadra.nome}</div>
                                                        <div class="text-xs">
                                                            ${formatDate(reserva.dataInicio, 'HH:mm')} - ${formatDate(reserva.dataFim, 'HH:mm')}
                                                        </div>
                                                    </div>
                                                `;
                                            }).join('') :
                                            '<div class="text-sm text-gray-500">Disponível</div>'
                                        }
                                    </div>
                                    <button onclick="openQuickReserveModal(new Date(${appState.selectedDate.getFullYear()}, ${appState.selectedDate.getMonth()}, ${appState.selectedDate.getDate()}), ${hour})" 
                                            class="flex-shrink-0 px-3 py-1 border border-gray-300 rounded hover:bg-gray-50" 
                                            title="Reserva rápida">
                                        <i data-lucide="plus"></i>
                                    </button>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        function renderCalendar() {
            const content = document.getElementById('calendar-content');
            
            let html = '';
            if (appState.view === 'month') {
                html = renderMonthView();
            } else if (appState.view === 'week') {
                html = renderWeekView();
            } else if (appState.view === 'day') {
                html = renderDayView();
            }
            
            content.innerHTML = html;
            
            // Re-initialize Lucide icons
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }

        // Initialize the calendar
        document.addEventListener('DOMContentLoaded', function() {
            renderCalendar();
        });
    </script>
</body>
</html>