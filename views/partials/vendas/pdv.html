<div
    class="flex flex-col xl:flex-row gap-4 xl:max-h-[calc(100vh-8rem)] border-border dark:border-border-dark bg-card dark:bg-card-dark shadow-md rounded-lg p-4 border">
    <!-- √Årea Principal - Produtos -->
    <div class="flex-1 flex flex-col">
        <!-- Header -->
        <div class="mb-6 flex flex-col gap-2">
            <h2 class="text-2xl font-bold text-black dark:text-white"><i class="fa-solid fa-tags text-green-600"></i>
                Ponto de vendas
            </h2>
            <!-- Barra de Busca -->
            <div class="relative">
                <input type="text" id="searchInput" placeholder="Buscar por nome ou c√≥digo..."
                    class="w-full p-2 rounded-md border bg-background dark:bg-background-dark border-border dark:border-border-dark">
            </div>
        </div>

        <!-- Grid de Produtos -->
        <div class="flex-1 overflow-y-auto scrollbar-thin">
            <div id="productsGrid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                <!-- Produtos ser√£o carregados aqui -->
            </div>
        </div>
    </div>

    <!-- Carrinho Lateral -->
    <div
        class="overflow-auto border-border dark:border-border-dark bg-background dark:bg-background-dark shadow-md rounded-lg p-4 border flex flex-col">
        <!-- Header do Carrinho -->
        <div class="p-4 border-b border-gray-200 dark:border-gray-700">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold">
                    <i class="fas fa-shopping-cart text-green-600 mr-2"></i>
                    Carrinho
                </h2>
                <button id="clearCartBtn"
                    class="text-red-500 dark:text-red-300 px-3 py-1 rounded-md bg-red-10 dark:bg-red-900 transition-colors"
                    title="Limpar carrinho">
                    <i class="fas fa-trash text-sm"></i>
                </button>
            </div>

            <!-- Sele√ß√£o de Cliente -->
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-white mb-2">Cliente</label>
                <select id="clientSelect"
                    class="w-full p-2 rounded-md border bg-card dark:bg-card-dark border-border dark:border-border-dark">
                    <option value="">Selecionar cliente...</option>
                    <option value="1">Jo√£o Silva</option>
                    <option value="2">Maria Santos</option>
                    <option value="3">Pedro Costa</option>
                </select>
            </div>
        </div>

        <!-- Lista de Itens do Carrinho -->
        <div class="flex-1 overflow-y-auto scrollbar-thin p-4">
            <div id="cartItems">
                <div class="text-center text-gray-500 dark:text-gray-400 py-8">
                    <i class="fas fa-shopping-cart text-4xl mb-3 opacity-50"></i>
                    <p>Carrinho vazio</p>
                    <p class="text-sm">Adicione produtos para come√ßar</p>
                </div>
            </div>
        </div>

        <!-- Footer do Carrinho -->
        <div
            class="p-4 border-border dark:border-border-dark bg-background dark:bg-background-dark shadow-md rounded-lg">
            <!-- Desconto -->
            <div class="mb-4">
                <div class="flex items-center gap-2 mb-2">
                    <select id="discountType"
                        class="w-full p-2 rounded-md border bg-card dark:bg-card-dark border-border dark:border-border-dark">
                        <option value="percentage">Desconto %</option>
                        <option value="value">Desconto R$</option>
                    </select>
                    <input type="text" id="discountValue" placeholder="0,00"
                        class="w-full p-2 rounded-md border bg-card dark:bg-card-dark border-border dark:border-border-dark">
                </div>
            </div>

            <!-- Totais -->
            <div class="space-y-2 mb-4">
                <div class="flex justify-between text-sm">
                    <span>Subtotal:</span>
                    <span id="subtotal">R$ 0,00</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span>Desconto:</span>
                    <span id="discount">R$ 0,00</span>
                </div>
                <div class="flex justify-between text-lg font-semibold border-t pt-2">
                    <span>Total:</span>
                    <span id="total">R$ 0,00</span>
                </div>
            </div>

            <!-- Forma de Pagamento -->
            <div class="mb-4 flex flex-col gap-2">
                <label class="block text-sm font-medium text-gray-700 dark:text-white mb-2">Pagamento</label>
                <select id="paymentMethod"
                    class="w-full p-2 rounded-md border bg-card dark:bg-card-dark border-border dark:border-border-dark">
                    <option value="money">Dinheiro</option>
                    <option value="card">Cart√£o</option>
                    <option value="pix">PIX</option>
                </select>

                <!-- Campo de Troco (apenas para dinheiro) -->
                <div id="changeSection" class="space-y-2">
                    <input type="text" id="receivedAmount" placeholder="Valor recebido"
                        class="w-full p-2 rounded-md border bg-card dark:bg-card-dark border-border dark:border-border-dark">
                    <div class="flex justify-between text-sm font-medium">
                        <span>Troco:</span>
                        <span id="changeAmount">R$ 0,00</span>
                    </div>
                </div>
            </div>

            <!-- Bot√£o Finalizar Venda -->
            <button id="finalizeSaleBtn"
                class="w-full bg-blue-500 dark:bg-blue-600 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg transition-colors disabled:bg-gray-400 dark:disabled:bg-gray-400 disabled:cursor-not-allowed"
                disabled>
                <i class="fas fa-check mr-2"></i>
                Finalizar Venda
            </button>
        </div>
    </div>
</div>

<!-- Modal de Sucesso -->
<div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg p-8 max-w-md mx-4 text-center">
        <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-check text-2xl text-green-600"></i>
        </div>
        <h3 class="text-xl font-bold text-gray-800 mb-2">Venda Finalizada!</h3>
        <p class="text-gray-600 mb-6">A venda foi processada com sucesso.</p>
        <button id="newSaleBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg">
            Nova Venda
        </button>
    </div>
</div>

<script>
    // Dados de exemplo dos produtos
    (() => {
        const products = [
            { id: 1, name: 'Smartphone Samsung', code: '001', price: 899.99, stock: 15, image: 'üì±' },
            { id: 2, name: 'Notebook Dell', code: '002', price: 2499.99, stock: 8, image: 'üíª' },
            { id: 3, name: 'Mouse Logitech', code: '003', price: 89.99, stock: 25, image: 'üñ±Ô∏è' },
            { id: 4, name: 'Teclado Mec√¢nico', code: '004', price: 299.99, stock: 12, image: '‚å®Ô∏è' },
            { id: 5, name: 'Monitor 24"', code: '005', price: 699.99, stock: 6, image: 'üñ•Ô∏è' },
            { id: 6, name: 'Headset Gamer', code: '006', price: 199.99, stock: 20, image: 'üéß' },
            { id: 7, name: 'Webcam HD', code: '007', price: 149.99, stock: 30, image: 'üìπ' },
            { id: 8, name: 'SSD 500GB', code: '008', price: 349.99, stock: 18, image: 'üíæ' },
        ];

        let cart = [];
        let subtotalValue = 0;
        let discountValue = 0;
        let totalValue = 0;

        // Inicializa√ß√£o
        $(document).ready(function () {
            renderProducts(products);
            setupEventListeners();
            toggleChangeSection();
        });

        // Renderizar produtos
        function renderProducts(productsToRender) {
            const grid = $('#productsGrid');
            grid.empty();

            productsToRender.forEach(product => {
                const productCard = `
                    <div class="border-border dark:border-border-dark bg-background dark:bg-background-dark shadow-md rounded-lg p-4 card-hover cursor-pointer product-card" 
                         data-product-id="${product.id}">
                        <div class="text-center mb-3">
                            <h3 class="text-gray-800 dark:text-white text-sm mb-1">${product.name}</h3>
                            <p class="text-gray-500 dark:text-gray-400 text-xs mb-2">C√≥d: ${product.code}</p>
                            <p class="text-lg font-bold text-green-600 dark:text-green-400">R$ ${product.price.toFixed(2).replace('.', ',')}</p>
                            <p class="text-xs text-gray-500 dark:text-gray-400">Estoque: ${product.stock}</p>
                        </div>
                        <button class="w-full bg-blue-600 hover:bg-blue-700 text-white text-sm py-2 px-3 rounded-lg transition-colors add-to-cart-btn"
                                data-product-id="${product.id}">
                            <i class="fas fa-plus mr-1"></i>
                            Adicionar
                        </button>
                    </div>
                `;
                grid.append(productCard);
            });
        }

        // Configurar event listeners
        function setupEventListeners() {
            // Busca de produtos
            $('#searchInput').on('input', function () {
                const searchTerm = $(this).val().toLowerCase();
                const filteredProducts = products.filter(product =>
                    product.name.toLowerCase().includes(searchTerm) ||
                    product.code.toLowerCase().includes(searchTerm)
                );
                renderProducts(filteredProducts);
            });

            // Adicionar ao carrinho
            $(document).on('click', '.add-to-cart-btn', function (e) {
                e.stopPropagation();
                const productId = parseInt($(this).data('product-id'));
                addToCart(productId);
            });

            // Limpar carrinho
            $('#clearCartBtn').on('click', clearCart);

            // M√©todo de pagamento
            $('#paymentMethod').on('change', toggleChangeSection);

            // Valor recebido
            $('#receivedAmount').on('input', calculateChange);

            // Desconto
            $('#discountValue').on('input', calculateTotals);
            $('#discountType').on('change', calculateTotals);

            // Finalizar venda
            $('#finalizeSaleBtn').on('click', finalizeSale);

            // Nova venda
            $('#newSaleBtn').on('click', newSale);
        }

        // Adicionar produto ao carrinho
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            const existingItem = cart.find(item => item.id === productId);

            if (existingItem) {
                if (existingItem.quantity < product.stock) {
                    existingItem.quantity++;
                } else {
                    alert('Estoque insuficiente!');
                    return;
                }
            } else {
                cart.push({
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    quantity: 1,
                    stock: product.stock
                });
            }

            renderCart();
            calculateTotals();
        }

        // Remover do carrinho
        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            renderCart();
            calculateTotals();
        }

        // Alterar quantidade
        function updateQuantity(productId, newQuantity) {
            const item = cart.find(item => item.id === productId);
            if (item) {
                if (newQuantity <= 0) {
                    removeFromCart(productId);
                } else if (newQuantity <= item.stock) {
                    item.quantity = newQuantity;
                    renderCart();
                    calculateTotals();
                } else {
                    alert('Estoque insuficiente!');
                }
            }
        }

        // Renderizar carrinho
        function renderCart() {
            const cartContainer = $('#cartItems');

            if (cart.length === 0) {
                cartContainer.html(`
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-shopping-cart text-4xl mb-3 opacity-50"></i>
                        <p>Carrinho vazio</p>
                        <p class="text-sm">Adicione produtos para come√ßar</p>
                    </div>
                `);
                $('#finalizeSaleBtn').prop('disabled', true);
                return;
            }

            let cartHtml = '';
            cart.forEach(item => {
                cartHtml += `
                    <div class="border-border dark:border-border-dark bg-card dark:bg-card-dark shadow-md rounded-lg p-3 mb-3">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="font-medium text-sm text-gray-800 dark:text-white">${item.name}</h4>
                            <button class="text-red-500 hover:text-red-700 text-sm" 
                                    onclick="removeFromCart(${item.id})">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-2">
                                <button class="w-6 h-6 bg-gray-300 dark:bg-gray-900 rounded text-xs"
                                        onclick="updateQuantity(${item.id}, ${item.quantity - 1})">-</button>
                                <span class="text-sm font-medium">${item.quantity}</span>
                                <button class="w-6 h-6 bg-gray-300 dark:bg-gray-900 rounded text-xs"
                                        onclick="updateQuantity(${item.id}, ${item.quantity + 1})">+</button>
                            </div>
                            <div class="text-right">
                                <p class="text-xs text-gray-500">R$ ${item.price.toFixed(2).replace('.', ',')}</p>
                                <p class="font-bold text-sm">R$ ${(item.price * item.quantity).toFixed(2).replace('.', ',')}</p>
                            </div>
                        </div>
                    </div>
                `;
            });

            cartContainer.html(cartHtml);
            $('#finalizeSaleBtn').prop('disabled', false);
        }

        // Calcular totais
        function calculateTotals() {
            subtotalValue = cart.reduce((total, item) => total + (item.price * item.quantity), 0);

            const discountInput = $('#discountValue').val().replace(',', '.');
            const discountType = $('#discountType').val();

            if (discountInput && !isNaN(discountInput)) {
                if (discountType === 'percentage') {
                    discountValue = subtotalValue * (parseFloat(discountInput) / 100);
                } else {
                    discountValue = parseFloat(discountInput);
                }
            } else {
                discountValue = 0;
            }

            totalValue = subtotalValue - discountValue;
            if (totalValue < 0) totalValue = 0;

            $('#subtotal').text(`R$ ${subtotalValue.toFixed(2).replace('.', ',')}`);
            $('#discount').text(`R$ ${discountValue.toFixed(2).replace('.', ',')}`);
            $('#total').text(`R$ ${totalValue.toFixed(2).replace('.', ',')}`);

            calculateChange();
        }

        // Mostrar/ocultar se√ß√£o de troco
        function toggleChangeSection() {
            const paymentMethod = $('#paymentMethod').val();
            if (paymentMethod === 'money') {
                $('#changeSection').show();
            } else {
                $('#changeSection').hide();
                $('#changeAmount').text('R$ 0,00');
            }
        }

        // Calcular troco
        function calculateChange() {
            if ($('#paymentMethod').val() !== 'money') return;

            const receivedAmount = parseFloat($('#receivedAmount').val().replace(',', '.')) || 0;
            const change = receivedAmount - totalValue;

            $('#changeAmount').text(`R$ ${Math.max(0, change).toFixed(2).replace('.', ',')}`);
        }

        // Limpar carrinho
        function clearCart() {
            cart = [];
            renderCart();
            calculateTotals();
        }

        // Finalizar venda
        function finalizeSale() {
            if (cart.length === 0) {
                alert('Carrinho vazio!');
                return;
            }

            const paymentMethod = $('#paymentMethod').val();
            if (paymentMethod === 'money') {
                const receivedAmount = parseFloat($('#receivedAmount').val().replace(',', '.')) || 0;
                if (receivedAmount < totalValue) {
                    alert('Valor recebido insuficiente!');
                    return;
                }
            }

            // Simular processamento da venda
            $('#successModal').removeClass('hidden').addClass('flex');
        }

        // Nova venda
        function newSale() {
            clearCart();
            $('#clientSelect').val('');
            $('#discountValue').val('');
            $('#receivedAmount').val('');
            $('#paymentMethod').val('money');
            toggleChangeSection();
            $('#successModal').removeClass('flex').addClass('hidden');
        }

        // M√°scaras para campos monet√°rios
        $('#discountValue, #receivedAmount').on('input', function () {
            let value = $(this).val().replace(/\D/g, '');
            value = (value / 100).toFixed(2).replace('.', ',');
            $(this).val(value);
        });
    })();
</script>