<div class="flex flex-col gap-6">
  <div class="flex flex-col md:flex-row gap-2 justify-between items-center">
    <h2 class="text-xl md:text-2xl font-bold text-black dark:text-white">
      <i class="fa-solid fa-money-bill-trend-up text-emerald-600"></i> Painel financeiro
    </h2>
    <div class="flex items-center space-x-2 w-content">
      <button type="button" id="limpar_filtro_dashboard_periodo"
        class="bg-red-600 text-white text-nowrap px-3 py-1.5 rounded-md text-sm hover:bg-red-700 transition-colors">
        <i class="fa-solid fa-filter-circle-xmark"></i>
      </button>
      <input id="filtro_dashboard_periodo" placeholder="Filtrar por período"
        class="rounded-md border w-max bg-card dark:bg-card-dark border-border dark:border-border-dark px-3 py-1.5 text-sm focus:outline-none focus:ring-2 focus:ring-primary">
      </input>
      <button
        class="bg-primary text-white text-nowrap px-4 py-1.5 rounded-md text-sm hover:bg-primary transition-colors"><i
          class="fa-solid fa-file-pdf"></i>
        <div class="hidden md:inline">Exportar</div>
      </button>
    </div>
  </div>

  <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 md:gap-6 xl:grid-cols-4">
    <!-- Metric Item Start -->
    <div onclick="loadPage('/clientes/resumo')"
      class="rounded-2xl cursor-pointer border border-border dark:border-border-dark bg-emerald-50 dark:bg-emerald-950/50 px-6 pb-5 pt-6">
      <div class="mb-6 flex items-center gap-3">
        <i class="fa-solid fa-arrow-up h-8 w-8 bg-emerald-500/10 p-2 rounded-md text-emerald-500"></i>

        <div>
          <h3 class="text-base font-semibold text-gray-800 dark:text-white/90">
            Total
          </h3>
          <span class="block text-theme-xs text-gray-500 dark:text-gray-400">
            Receitas
          </span>
        </div>
      </div>

      <div class="flex items-end justify-between">
        <div>
          <h4 class="text-lg font-semibold text-gray-800 dark:text-white/90" id="total_receitas_dashboard">
            0
          </h4>
        </div>

        <span
          class="flex items-center gap-1 rounded-full bg-green-50 py-0.5 pl-2 pr-2.5 text-xs font-medium text-green-600 dark:bg-green-500/15 dark:text-green-500">
          <i class="fa-solid fa-coins"></i>
          Entradas
        </span>
      </div>
    </div>

    <div onclick="loadPage('/lancamentos/resumo')"
      class="rounded-2xl cursor-pointer border border-border dark:border-border-dark bg-red-50 dark:bg-red-950/50 px-6 pb-5 pt-6">
      <div class="mb-6 flex items-center gap-3">
        <i class="fa-solid fa-arrow-down w-8 h-8 bg-red-500/10 p-2 rounded-md text-red-500"></i>

        <div>
          <h3 class="text-base font-semibold text-gray-800 dark:text-white/90">
            Total
          </h3>
          <span class="block text-theme-xs text-gray-500 dark:text-gray-400">
            Despesas
          </span>
        </div>
      </div>

      <div class="flex items-end justify-between">
        <div>
          <h4 class="text-lg font-semibold text-gray-800 dark:text-white/90" id="total_despesas_dashboard">
            0
          </h4>
        </div>

        <span
          class="flex items-center gap-1 rounded-full bg-red-100 py-0.5 pl-2 pr-2.5 text-xs font-medium text-red-600 dark:bg-red-500/15 dark:text-red-500">
          <i class="fa-solid fa-coins"></i>
          Saídas
        </span>
      </div>
    </div>

    <div onclick="loadPage('/produtos/resumo')"
      class="rounded-2xl cursor-pointer border border-border dark:border-border-dark bg-blue-50 dark:bg-blue-950/50 px-6 pb-5 pt-6">
      <div class="mb-6 flex items-center gap-3">
        <i class="fa-solid fa-money-bill-trend-up w-8 h-8 bg-blue-500/10 p-2 rounded-md text-blue-500"></i>

        <div>
          <h3 class="text-base font-semibold text-gray-800 dark:text-white/90">
            Saldo
          </h3>
          <span class="block text-theme-xs text-gray-500 dark:text-gray-400">
            Geral
          </span>
        </div>
      </div>

      <div class="flex items-end justify-between">
        <div>
          <h4 class="text-lg font-semibold text-gray-800 dark:text-white/90" id="saldo_financeiro_dashboard">
            0
          </h4>
        </div>

        <span id="produtos_em_baixa_dashboard_alerta"
          class="flex items-center gap-1 rounded-full bg-blue-100 py-0.5 pl-2 pr-2.5 text-xs font-medium text-blue-600 dark:bg-blue-500/15 dark:text-blue-500">
          <i class="fa-solid fa-coins"></i>
          Lucro
        </span>
      </div>
    </div>

    <div onclick="loadPage('/vendas/resumo')"
      class="rounded-2xl cursor-pointer border border-border dark:border-border-dark bg-yellow-50 dark:bg-yellow-950/50 px-6 pb-5 pt-6">
      <div class="mb-6 flex items-center gap-3">
        <i class="fa-solid fa-hourglass-end h-8 w-8 bg-yellow-500/10 p-2 rounded-md text-yellow-400"></i>

        <div>
          <h3 class="text-base font-semibold text-gray-800 dark:text-white/90">
            Lançamentos
          </h3>
          <span class="block text-theme-xs text-gray-500 dark:text-gray-400">
            Pendentes
          </span>
        </div>
      </div>

      <div class="flex items-end justify-between">
        <div>
          <h4 class="text-lg font-semibold text-gray-800 dark:text-white/90" id="resumo_pendentes_total">
            R$ 0,00
          </h4>
        </div>

        <span id="porcentagem_vendas_dashboard_alerta"
          class="flex items-center gap-1 rounded-full bg-yellow-50 py-0.5 pl-2 pr-2.5 text-xs font-medium text-yellow-600 dark:bg-yellow-500/15 dark:text-yellow-500">
          <i class="fa-solid fa-dollar-sign"></i>
          <span id="porcentagem_vendas_dashboard">
            Revisar
          </span>
        </span>
      </div>
    </div>
    <!-- Metric Item End -->
  </div>

  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
    <!-- Gráfico de Barras -->
    <div
      class="border-border dark:border-border-dark bg-card dark:bg-card-dark shadow-md rounded-lg p-4 col-span-1 sm:col-span-2 lg:col-span-2 border">
      <h2 class="text-lg font-semibold mb-4"><i class="fa-solid fa-chart-simple text-emerald-600"></i> Balanço mensal
      </h2>
      <canvas class="max-h-64" id="grafico_receita_despesa_mensal"></canvas>
    </div>

    <div
      class="border-border dark:border-border-dark bg-card dark:bg-card-dark shadow-md rounded-lg p-4 col-span-1 sm:col-span-2 lg:col-span-2 border">
      <h2 class="text-lg font-semibold mb-4"><i class="fa-solid fa-chart-simple text-emerald-600"></i> Resumo por status
      </h2>
      <canvas class="max-h-64" id="grafico_por_status_pagamento"></canvas>
    </div>

    <div
      class="border-border dark:border-border-dark bg-card dark:bg-card-dark shadow-md rounded-lg p-4 col-span-1 sm:col-span-2 lg:col-span-2 border">
      <h2 class="text-lg font-semibold mb-4"><i class="fa-solid fa-chart-simple text-emerald-600"></i> Plano de contas</h2>
      <canvas class="max-h-64" id="grafico_plano_contas"></canvas>
    </div>

    <div
      class="border-border dark:border-border-dark bg-card dark:bg-card-dark shadow-md rounded-lg p-4 col-span-1 sm:col-span-2 lg:col-span-2 border">
      <h2 class="text-lg font-semibold mb-4"><i class="fa-solid fa-chart-pie text-emerald-600"></i> Resumo por categoria
      </h2>
      <canvas class="max-h-64" id="grafico_por_categoria"></canvas>
    </div>
  </div>
</div>

<nav
  class="fixed bottom-0 left-0 w-full bg-card dark:bg-card-dark border-t border-border dark:border-border-dark md:hidden flex justify-around pt-4 h-20 shadow-lg z-20">
  <button type="button" onclick="loadPage('/lancamentos/resumo')"
    class="flex flex-col items-center disabled:text-gray-300 disabled:dark:text-gray-600 text-gray-700 dark:text-gray-300 cursor-pointer hover:text-primary transition">
    <i class="fa-solid fa-money-bill-trend-up text-lg"></i>
    <span class="text-xs">Lançamentos</span>
  </button>
  <button type="button" onclick="openSideBarMobile()"
    class="flex flex-col items-center disabled:text-gray-300 disabled:dark:text-gray-600 text-gray-700 dark:text-gray-300 cursor-pointer hover:text-primary transition">
    <i class="fa-solid fa-bars text-lg"></i>
    <span class="text-xs">Menu</span>
  </button>
</nav>

<script>
  (() => {
    if (window.innerWidth < 768) {
      switchToNormalScreen();
    }
    function chartByCategoria(data) {
      new Chart(document.getElementById('grafico_por_categoria'), {
        type: 'pie',
        data: {
          labels: data.labels,
          datasets: data.datasets,
        },
        options: {
          scales: {
            y: {
              display: false,
              beginAtZero: true
            },
            x: {
              display: false,
            }
          },
          plugins: {
            title: {
              display: false
            },
            legend: {
              display: false
            }
          }
        }
      });
    }
    function chartByDespesasPorStatus(data) {
      new Chart(document.getElementById('grafico_por_status_pagamento'), {
        type: 'bar',
        data: {
          labels: data.labels,
          datasets: data.datasets,
        },
        options: {
          interaction: {
            mode: 'index',
            intersect: false,
          },
          plugins: {
            title: {
              display: false
            },
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              stacked: true,
              ticks: {
                color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#000000',
              }
            },
            x: {
              stacked: true,
              ticks: {
                color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#000000',
              }
            },
          }
        }
      });
    }
    function chartByReceitaDespesa(data) {
      new Chart(document.getElementById('grafico_receita_despesa_mensal'), {
        type: 'bar',
        data: {
          labels: data.labels,
          datasets: data.datasets,
        },
        options: {
          interaction: {
            mode: 'index',
            intersect: false,
          },
          plugins: {
            title: {
              display: false
            },
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              ticks: {
                color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#000000',
              }
            },
            x: {
              ticks: {
                color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#000000',
              }
            },
          }
        }
      });
    }
    function chartByPlanoConta(data) {
      new Chart(document.getElementById('grafico_plano_contas'), {
        type: 'bar',
        data: {
          labels: data.labels,
          datasets: data.datasets,
        },
        options: {
          interaction: {
            mode: 'index',
            intersect: false,
          },
          plugins: {
            title: {
              display: false
            },
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              ticks: {
                color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#000000',
              }
            },
            x: {
              ticks: {
                color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#000000',
              }
            },
          }
        }
      });
    }
    async function generateChatsFinanceiro(inicio, fim) {
      fetch(`/lancamentos/relatorios/totais`, {
        method: "GET",
        headers: {
          Authorization: `Bearer ${localStorage.getItem("gestao_facil:token")}`,
        }
      })
        .then((response) => response.json())
        .then((data) => {
          $("#saldo_financeiro_dashboard").text(data.saldo);
          $("#total_despesas_dashboard").text(data.despesas);
          $("#total_receitas_dashboard").text(data.receitas);
        });
      fetch(`/lancamentos/relatorios/valor-status`, {
        method: "GET",
        headers: {
          Authorization: `Bearer ${localStorage.getItem("gestao_facil:token")}`,
        }
      })
        .then((response) => response.json())
        .then((data) => {
          $("#resumo_pendentes_total").text(data.pendente);
        });
      //Grafico por categoria
      fetch(`/lancamentos/graficos/categorias?inicio=${inicio}&fim=${fim}`, {
        method: "GET",
        headers: {
          Authorization: `Bearer ${localStorage.getItem("gestao_facil:token")}`,
        }
      })
        .then((response) => response.json())
        .then((data) => {
          chartByCategoria(data);
        });
      fetch(`/lancamentos/graficos/contas?inicio=${inicio}&fim=${fim}`, {
        method: "GET",
        headers: {
          Authorization: `Bearer ${localStorage.getItem("gestao_facil:token")}`,
        }
      })
        .then((response) => response.json())
        .then((data) => {
          chartByPlanoConta(data);
        });
      fetch(`/lancamentos/graficos/receita-despesa-mensal`, {
        method: "GET",
        headers: {
          Authorization: `Bearer ${localStorage.getItem("gestao_facil:token")}`,
        }
      })
        .then((response) => response.json())
        .then((data) => {
          chartByReceitaDespesa(data);
        });
      fetch(`/lancamentos/graficos/status?inicio=${inicio}&fim=${fim}`, {
        method: "GET",
        headers: {
          Authorization: `Bearer ${localStorage.getItem("gestao_facil:token")}`,
        }
      })
        .then((response) => response.json())
        .then((data) => {
          console.log(data);
          chartByDespesasPorStatus(data);
        });
    };

    generateChatsFinanceiro("2025-01-01", "2025-12-31");
  })();
</script>